<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de contacto</title>

    <link rel="icon" type="image/png" href="favicon/favicon-96x96" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
    <link rel="shortcut icon" href="favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="contacto.css">

    <meta name="apple-mobile-web-app-title" content="miTienda" />
</head>

<body>
    <header>
        <nav>
             <a href="index.html">
                <img 
                src="/assets/images/4GFYMYJE5ZDWXGOEOYWI7XSIAQ.avif"
                width="42" height="42"
                alt="Logo"
                >
            </a>
            <a href="index.html">Inicio</a>
            <a href="productos.html">Productos</a>
            <a href="contactos.html">Contacto</a>
            <a href="/pages/registro.html">Registrarse</a>
            <!--Ejemplo de imagen que redirecciona a la pagina carrito-->
            <a href="/pages/carrito.html">
                <img
                    src="/assets/images/carrito.png"
                    width="42" height="42" 
                    alt="Carrito" 
                >   
            </a>
        </nav>
    </header>

    <aside>

    </aside>

    <main class="d-flex justify-content-center my-5">
        <section class="container my-5">
            <div class="card-custom">
                <h3>Formulario de Contacto</h3>
                <div class="card-body-custom">

                <form id="formulario">

                <div class="mb-3">
                    <label for="nombreContacto" class="form-label">Nombre completo: </label>
                    <input type="text" name="nombreContacto" id="nombreContacto" class="form-control" required>
                    <span id="mensaje-nombre" class="error"></span>
                </div>

                <div class="mb-3">
                    <label for="mail" class="form-label">Email: </label>
                    <input type="email" name="mail" id="mail" class="form-control" required>
                    <span id="mensaje-email" class="error"></span>
                </div>

                <div class="mb-3">
                    <label for="telefono" class="form-label">Numero de telefono: </label>
                    <input type="tel" name="telefono" id="telefono" class="form-control" required>
                    <span id="mensaje-telefono" class="error"></span>
                </div>

                <div class="mb-3">
                    <label for="mensaje" class="form-label">Mensaje: </label>
                    <textarea name="mensaje" id="mensaje" rows="5" class="form-control"></textarea>
                    <span id="mensaje-mensaje" class="error"></span>
                </div>
                
                <div class="form-check mb-3">
                    <input type="checkbox" id="acepto" name="acepto" class="form-check-input" required>
                    <label for="acepto" class="form-check-label">Acepto que me contacten</label>
                    <span id="mensaje-check" class="error"></span>
                </div>

                <button type="submit" class="btn btn-dark">Enviar</button>
            
                </form>
                </div>
            </div>
        </section>

            <script>
                const nombreInput = document.getElementById("nombreContacto");
                const mensajeNombre = document.getElementById("mensaje-nombre");

                nombreInput.addEventListener("input", () => {
                        if(nombreInput.value.length < 5) {
                            mensajeNombre.textContent = "El nombre debe tener al menos 5 letras";
                            mensajeNombre.style.color = "red";
                        } else {
                            mensajeNombre.textContent = "Nombre validado.";
                            mensajeNombre.style.color = "green";
                        }
                    }
                );

                const correoEmail = document.getElementById("mail");
                const mensajeEmail = document.getElementById("mensaje-email");

                correoEmail.addEventListener("input", () => {
                    if(correoEmail.value.includes("@") && correoEmail.value.length >= 6) {
                        mensajeEmail.textContent = "Email validado.";
                        mensajeEmail.style.color = "green";
                    } else {
                        mensajeEmail.textContent = "El email debe contener @ y al menos 6 caracteres.";
                        mensajeEmail.style.color = "red";
                    }
                });

                const telefonoInput = document.getElementById("telefono");
                const mensajeTelefono = document.getElementById("mensaje-telefono");

                telefonoInput.addEventListener("input", () =>{
                    if(telefonoInput.value.length < 6) {
                        mensajeTelefono.textContent = "Numero de telefono invalido";
                        mensajeTelefono.style.color = "red";
                    } else {
                        mensajeTelefono.textContent = "Numero de telefono valido";
                        mensajeTelefono.style.color = "green";
                    }

                })

                const mensajeInput = document.getElementById("mensaje");
                const mensajeMensaje = document.getElementById("mensaje-mensaje");

                mensajeInput.addEventListener("input", () =>{
                    if(mensajeInput.value.trim().length < 5) {
                        mensajeMensaje.textContent = "El mensaje debe contener mas de 5 caracteres";
                        mensajeMensaje.style.color = "red";
                    } else {
                        mensajeMensaje.textContent = "Mensaje validado.";
                        mensajeMensaje.style.color = "green";
                    }
                })

                const checkInput = document.getElementById("acepto");
                const checkMensaje = document.getElementById("mensaje-check");

                checkInput.addEventListener("change", () => {
                    if(checkInput.checked === false) {
                        checkMensaje.textContent = "Debes aceptar que te contacten.";
                        checkMensaje.style.color = "red";
                    } else {
                        checkMensaje.textContent = "Aceptado";
                        checkMensaje.style.color = "green";
                    }
                } )


                formulario.addEventListener("submit", async (e) => { //async: funci√≥n que puede esperar cosas que tardan en completarse (submit con fetch)
                    e.preventDefault(); //Evita que se recargue la pagina

                    const datos = {
                        nombre: nombreInput.value,
                        email: correoEmail.value,
                        telefono: telefonoInput.value,
                        mensaje: mensajeInput.value
                    };

                    try { //si falla try, se capta el error con catch
                        const res = await fetch("https://jsonplaceholder.typicode.com/posts", { //await: espera a que la API responda antes de continuar; se define una constante de respuesta donde se guarda la respuesta del servidor (si estan "bien" o "mal" los datos enviados)
                            method: "POST", //enviamos datos al servidor (mock API)
                            headers: { "Content-Type": "application/json" }, //los headers son informacion adicional para que el servidor pueda interpretar la informacion (enviamos info en formato json en este caso)
                            body: JSON.stringify(datos) //el contenido que enviamos al servidor (datos en formato json)
                        });

                        const data = await res.json(); //await res.json lee el cuerpo de la respuesta (que viene en JSON) y lo convierte en un objeto js, para que data(objeto) pueda acceder a sus propiedades (data.nombre, data.email etc)
                        alert("Formulario enviado: " + JSON.stringify(data)); //se pasa a data como string porque alert muestra texto, y se envia el formulario a un mock

                    } catch (error) { //recibe la info sobre lo que salio mal 
                        alert("Error al enviar: " + error);
                    }
                });
            </script>

        </section>
    </main>

    <footer>

    </footer>
</body>
</html>
